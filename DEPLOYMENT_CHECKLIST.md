# 🚀 배포 전 필수 체크리스트

## ✅ **1. 엔드포인트 표준화 (외부 계약 고정)**

- [ ] **POST /api/v1/auth/send-sms** - SMS 전송
- [ ] **POST /api/v1/auth/verify-code** - OTP 검증  
- [ ] **POST /api/v1/auth/resend-sms** - SMS 재전송
- [ ] 모든 응답이 `StandardResponse` 형식으로 통일됨
- [ ] `success`, `code`, `message`, `data`, `requestId` 필드 포함

## ✅ **2. 회원가입 제출 규칙**

- [ ] 프론트엔드는 멀티스텝 수집
- [ ] 서버는 최종 1회 제출 (약관 동의 시점)
- [ ] `POST /api/v1/auth/register` 엔드포인트 구현
- [ ] 프론트는 수집·검증만, 서버는 signup 1회 처리

## ✅ **3. OTP 정책 코드/DB 반영**

- [ ] **TTL 5분** 설정
- [ ] **1분 3회** 재전송/요청 제한
- [ ] **1일 5회** 재전송/요청 제한
- [ ] DB에 **해시 저장** (`code_hash`)
- [ ] `expire_at`, `used_at`, `attempt_count` 필드
- [ ] 인덱스: `(phone_e164_norm, expire_at)`

## ✅ **4. 전화번호 E.164 정규화**

- [ ] 저장은 **+8210...** 단일 포맷만
- [ ] UI는 **+82 고정** 플레이스홀더
- [ ] 숫자 키패드 사용
- [ ] 가입·로그인·재전송 모두 동일 규칙

## ✅ **5. KYC PASS 연동**

- [ ] **PASS 1순위** (실패시 NICE 전환)
- [ ] **50세 미만 403** (`KYC_AGE_RESTRICTION`)
- [ ] **불일치 401** (`KYC_INFO_MISMATCH`)
- [ ] 라우트/코드값 고정 (STUB이어도)

## ✅ **6. 에러코드·HTTP 상태 중앙 매핑**

- [ ] **INVALID_CODE→401**
- [ ] **EXPIRED→410**  
- [ ] **RATE_LIMIT→429**
- [ ] 시스템 에러는 **SYS_500_INTERNAL**
- [ ] CI 스냅샷 테스트 1개 포함

## ✅ **7. 환경 분리와 시크릿 취급**

- [ ] **dev/stg/prod** 환경 분리
- [ ] **staging/prod .env**는 깃에 커밋 금지
- [ ] **SENS/NHN/PASS/Kakao/VWorld** 키는 Secrets Manager로 관리
- [ ] **ENV 직접 커밋 금지**

## ✅ **8. 마이그레이션 운영 규칙**

- [ ] **"스키마 추가 → 코드 배포 → 구필드 제거(2단계)"** 명문화
- [ ] CI/CD에 **배포 직후 마이그레이션 실행** 스텝 포함
- [ ] **롤백 기준은 에러율 5% 이상**

## ✅ **9. 릴리즈/롤백·헬스체크 조건**

- [ ] **롤링(또는 블루/그린) 배포**
- [ ] **readyz=200** + 에러율 임계치 충족할 때만 "성공"
- [ ] 실패 시 **이전 태그로 자동 롤백**

## ✅ **10. 외부 연동 타임아웃/리트라이/Failover**

- [ ] **기본 타임아웃 3초** (지도 5초)
- [ ] **리트라이 2회** 후 즉시 Failover
- [ ] 모든 외부 응답은 **내부 StandardResponse로 래핑**
- [ ] **옵스·관측 기준 동기화**

---

## 🔍 **배포 전 최종 확인**

### **코드 품질**
- [ ] TypeScript 컴파일 에러 없음
- [ ] ESLint 경고 없음
- [ ] 테스트 통과율 100%
- [ ] 코드 커버리지 80% 이상

### **보안**
- [ ] 환경변수에 민감한 정보 없음
- [ ] API 키가 코드에 하드코딩되지 않음
- [ ] CORS 설정 적절함
- [ ] Rate Limiting 적용됨

### **데이터베이스**
- [ ] 마이그레이션 스크립트 테스트 완료
- [ ] 인덱스 생성 확인
- [ ] 백업 스크립트 준비됨
- [ ] 롤백 마이그레이션 준비됨

### **모니터링**
- [ ] 헬스체크 엔드포인트 동작 확인
- [ ] 에러율 모니터링 설정됨
- [ ] 로그 수집 설정됨
- [ ] 알림 설정됨

---

## 🚨 **배포 중 주의사항**

1. **단계별 배포**: 한 번에 모든 것을 배포하지 말고 단계별로 진행
2. **헬스체크**: 각 단계 후 반드시 헬스체크 수행
3. **롤백 준비**: 문제 발생 시 즉시 롤백할 수 있도록 준비
4. **모니터링**: 배포 후 30분간 집중 모니터링
5. **문서화**: 배포 과정과 결과를 문서화

---

## 📋 **체크 완료 후**

- [ ] 모든 항목 체크 완료
- [ ] 팀 리뷰 완료
- [ ] 승인자 서명
- [ ] 배포 진행

**배포 담당자**: _________________  
**승인자**: _________________  
**배포 일시**: _________________
